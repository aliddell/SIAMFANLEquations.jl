<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>nsold: systems of equations with direct linear solvers · SIAMFANLEquations.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SIAMFANLEquations.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">SIAMFANLEquations.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Scalar Equations</span><ul><li><a class="tocitem" href="../nsolsc/">nsolsc: scalar equation solver</a></li><li><a class="tocitem" href="../ptcsolsc/">ptcsolsc: pseuto-transient continuation</a></li></ul></li><li><span class="tocitem">Systems with Direct Linear Solvers</span><ul><li class="is-active"><a class="tocitem" href>nsold: systems of equations with direct linear solvers</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Systems with Direct Linear Solvers</a></li><li class="is-active"><a href>nsold: systems of equations with direct linear solvers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>nsold: systems of equations with direct linear solvers</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ctkelley/SIAMFANLEquations.jl/blob/master/docs/src/functions/nsold.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="nsold:-systems-of-equations-with-direct-linear-solvers"><a class="docs-heading-anchor" href="#nsold:-systems-of-equations-with-direct-linear-solvers">nsold: systems of equations with direct linear solvers</a><a id="nsold:-systems-of-equations-with-direct-linear-solvers-1"></a><a class="docs-heading-anchor-permalink" href="#nsold:-systems-of-equations-with-direct-linear-solvers" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="SIAMFANLEquations.nsold-NTuple{5,Any}" href="#SIAMFANLEquations.nsold-NTuple{5,Any}"><code>SIAMFANLEquations.nsold</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">nsold(F!, x0, FS, FPS, J!=diffjac!; rtol=1.e-6, atol=1.e-12,
           maxit=20, solver=&quot;newton&quot;, sham=1, armmax=10, resdec=.1,
           dx = 1.e-7, armfix=false, 
           pdata = nothing, jfact = klfact,
           printerr = true, keepsolhist = false, stagnationok=false)</code></pre><p>)</p><p>C. T. Kelley, 2020</p><p>Julia versions of the nonlinear solvers from my SIAM books.  Herewith: nsold</p><p>You must allocate storage for the function and Jacobian in advance –&gt; in the calling program &lt;– ie. in FS and FPS</p><p>Inputs:</p><ul><li>F!: function evaluation, the ! indicates that F! overwrites FS, your   preallocated storage for the function.</li></ul><pre><code class="language-none">FV=F!(FV,x) or FV=F!(FV,x,pdata) returns FV=F(x)</code></pre><ul><li>x0: initial iterate</li></ul><ul><li>FS: Preallcoated storage for function. It is an N x 1 column vector</li></ul><ul><li>FPS: preallcoated storage for Jacobian. It is an N x N matrix</li></ul><ul><li>J!: Jacobian evaluation, the ! indicates that J! overwrites FPS, your   preallocated storage for the Jacobian. If you leave this out the   default is a finite difference Jacobian.</li></ul><pre><code class="language-none">FP=J!(FP,FV,x) or FP=J!(FP,FV,x,pdata) returns FP=F&#39;(x);
(FP,FV, x) must be the argument list, even if FP does not need FV.
One reason for this is that the finite-difference Jacobian
does and that is the default in the solver.

Lemme tell ya &#39;bout precision. I designed this code for full precision
functions and linear algebra in any precision you want. You can declare
FPS as Float64, Float32, or Float16 and nsold will do the right thing if
YOU do not destroy the declaration in your J! function. I&#39;m amazed
that this works so easily. If the Jacobian is reasonably well 
conditioned, I can see no reason to do linear algebra in 
double precision.</code></pre><hr/><p>Keyword Arguments (kwargs):</p><ul><li>rtol and atol: relative and absolute error tolerances</li></ul><ul><li>maxit: limit on nonlinear iterations</li></ul><p>solver: default = &quot;newton&quot;</p><p>Your choices are &quot;newton&quot; or &quot;chord&quot;. However, you have sham at your disposal only if you chose newton. &quot;chord&quot; will keep using the initial derivative until the iterate converges, uses the iteration budget, or the line search fails. It is not the same as sham=Inf, which is smarter.</p><p>sham: default = 1 (ie Newton)</p><p>This is the Shamanskii method. If sham=1, you have Newton. The iteration updates the derivative every sham iterations. The convergence rate has local q-order sham+1 if you only count iterations where you update the derivative. You need not provide your own derivative function to use this option. sham=Inf is chord only if chord is converging well.</p><p>armmax: upper bound on stepsize reductions in linesearch</p><p>resdec: default = .1</p><p>This is the target value for residual reduction. The default value is .1. In the old MATLAB codes it was .5. I only turn Shamanskii on if the residuals are decreasing rapidly, at least a factor of resdec, and the line search is quiescent. If you want to eliminate resdec from the method ( you don&#39;t ) then set resdec = 1.0 and you will never hear from it again.</p><p>dx: default = 1.e-7</p><p>difference increment in finite-difference derivatives       h=dx*norm(x)+1.e-6</p><p>armfix: default = false</p><p>The default is a parabolic line search (ie false). Set to true and the stepsize will be fixed at .5. Don&#39;t do this unless you are doing experiments for research.</p><p>pdata:</p><p>precomputed data for the function/Jacobian.  Things will go better if you use this rather than hide the data  in global variables within the module for your function/Jacobian</p><p>jfact: default = klfact (tries to figure out best choice) </p><p>If you have a dense Jacobian I call PrepareJac! to evaluate the Jacobian (using your J!) and factor it. The default is to use klfact (and internal function) to do something reasonable. For  general matrices, klfact picks  lu! to compute an LU factorization and share storage with the Jacobian. klfact knows about tridiagonal and banded matrices. If you give me something not on klfact&#39;s list, you get lu. You may change LU to something else by, for example, setting jfact = cholseky! if your Jacobian is spd. </p><p>Please do not mess with the line that calls PrepareJac!.          FPF = PrepareJac!(FPS, FS, x, ItRules) FPF is not the same as FPS (the storage you allocate for the Jacobian) for a reason. FPF and FPS do not have the same type, even though they share storage. So, FPS=PrepareJac!(FPS, FS, ...) will break things.</p><p>printerr: default = true</p><p>I print a helpful message when the solver fails. To supress that message set printerr to false.</p><p>keepsolhist: default = false</p><p>Set this to true to get the history of the iteration in the output tuple. This is on by default for scalar equations and off for systems. Only turn it on if you have use for the data, which can get REALLY LARGE.</p><p>stagnationok: default = false</p><p>Set this to true if you want to disable the line search and either observe divergence or stagnation. This is only useful for research or writing a book.</p><p>Output:</p><p>A named tuple (solution, functionval, history, stats, idid,                errcode, solhist) where</p><p>solution = converged result functionval = F(solution) history = the vector of residual norms (||F(x)||) for the iteration stats = named tuple of the history of (ifun, ijac, iarm), the number of functions/derivatives/steplength reductions at each iteration.</p><p>I do not count the function values for a finite-difference derivative because they count toward a Jacobian evaluation. </p><p>idid=true if the iteration succeeded and false if not.</p><p>errcode = 0 if if the iteration succeeded         = -1 if the initial iterate satisifies the termination criteria         = 10 if no convergence after maxit iterations         = 1  if the line search failed</p><p>solhist:</p><p>This is the entire history of the iteration if you&#39;ve set keepsolhist=true</p><hr/><p><strong>Examples</strong></p><p><strong>World&#39;s easiest problem example.</strong></p><pre><code class="language-julia-repl"> julia&gt; function f!(fv,x)
       fv[1]=x[1] + sin(x[2])
       fv[2]=cos(x[1]+x[2])
       end
f (generic function with 1 method)

julia&gt; x=ones(2,); fv=zeros(2,); jv=zeros(2,2);
julia&gt; nout=nsold(f!,x,fv,jv);
julia&gt; nout.history
5-element Array{Float64,1}:
 1.88791e+00
 2.43119e-01
 1.19231e-02
 1.03266e-05
 1.46416e-11

julia&gt; nout.solution
2-element Array{Float64,1}:
 -7.39085e-01
  2.30988e+00
</code></pre><p><strong>H-equation example</strong></p><pre><code class="language-julia-repl">julia&gt; n=16; x0=ones(n,); FV=ones(n,); JV=ones(n,n);
julia&gt; hdata=heqinit(x0, .5);
julia&gt; hout=nsold(heqf!,x0,FV,JV;pdata=hdata);
julia&gt; hout.history
3-element Array{Float64,1}:
 6.17376e-01
 3.17810e-03
 6.22034e-08</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ctkelley/SIAMFANLEquations.jl/blob/9ce031979763a3351b2ce776828fa6eb98fa4d60/src/Chapter2/nsold.jl#L1-L215">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ptcsolsc/">« ptcsolsc: pseuto-transient continuation</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 4 September 2020 12:19">Friday 4 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
